generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Asset {
  id                Int               @id @default(autoincrement())
  symbol            String
  name              String
  type              String
  volatility_bucket String
  chain_or_market   String
  pricing_mode      String
  manual_price      Decimal?
  metadata_json     String?
  created_at        DateTime          @default(now())
  updated_at        DateTime          @updatedAt

  ledger_transactions LedgerTransaction[]
  fee_transactions    LedgerTransaction[] @relation("FeeAssetTransactions")
  price_latest        PriceLatest?

  @@index([symbol])
}

model Account {
  id              Int                 @id @default(autoincrement())
  name            String
  platform        String
  account_type    String
  chain_or_market String?
  status          String
  notes           String?
  created_at      DateTime            @default(now())
  updated_at      DateTime            @updatedAt

  ledger_transactions LedgerTransaction[]

  @@index([name])
}

model LedgerTransaction {
  id                 Int        @id @default(autoincrement())
  date_time          DateTime
  account_id         Int
  asset_id           Int
  quantity           Decimal
  direction          String?
  base_price         Decimal
  base_value         Decimal
  tx_type            String
  fee_asset_id       Int?
  fee_quantity       Decimal?
  external_reference String?
  notes              String?
  created_at         DateTime   @default(now())
  updated_at         DateTime   @updatedAt

  account   Account @relation(fields: [account_id], references: [id])
  asset     Asset   @relation(fields: [asset_id], references: [id])
  fee_asset Asset?  @relation("FeeAssetTransactions", fields: [fee_asset_id], references: [id])

  @@index([date_time])
  @@index([account_id])
  @@index([asset_id])
  @@index([tx_type])
}

model PriceLatest {
  id            Int      @id @default(autoincrement())
  asset_id      Int      @unique
  price_in_base Decimal
  source        String
  last_updated  DateTime

  asset Asset @relation(fields: [asset_id], references: [id])
}

model Setting {
  key   String @id
  value String
}